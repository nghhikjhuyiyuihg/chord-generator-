<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title> 拽专 驻 住</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f8;
      direction: rtl;
      text-align: center;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    select, input[type="text"] {
      padding: 10px;
      width: 100%;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #f0f0f0;
    }
    td input {
      width: 100%;
      border: none;
      background: none;
      text-align: center;
      font-size: 16px;
    }
    .capo-box {
      margin-top: 30px;
      background: #eef2f7;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1> 拽专 驻 住</h1>

    <label for="scaleSelect">专 住:</label>
    <select id="scaleSelect" onchange="updateTable()"></select>

    <table>
      <thead>
        <tr>
          <th>专</th>
          <th>拽专</th>
          <th>转驻拽 砖注专</th>
        </tr>
      </thead>
      <tbody id="chordTable"></tbody>
    </table>

    <div class="capo-box">
      <h3>砖 拽 拽驻 </h3>
      <label for="fromScale">住 砖转  :</label>
      <select id="fromScale"></select>
      <label for="toScale">住 砖转 专爪 砖砖注:</label>
      <select id="toScale"></select>
      <button onclick="calculateCapo()">砖</button>
      <p id="capoResult"></p>
    </div>
  </div>
  <script>
    const chromatic = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];

    const majorPattern = [
      ["I", "Major", "专 砖专"],
      ["ii", "minor", "砖砖 注拽 注专"],
      ["iii", "minor", "爪 专砖"],
      ["IV", "Major", "拽专 注专"],
      ["V", "Major", "拽专 拽 驻 专"],
      ["vi", "minor", "拽专 注爪/驻 住住"],
      ["vii掳", "diminished", " 爪, 爪专 转"]
    ];

    const minorPattern = [
      ["i", "minor", "专 住 注爪"],
      ["ii掳", "diminished", "转"],
      ["III", "Major", "转砖转 转拽"],
      ["iv", "minor", "注拽"],
      ["v", "minor", "转 驻 驻转专"],
      ["VI", "Major", "专 专砖转"],
      ["VII", "Major", "驻 专 拽"]
    ];

    const enharmonicMap = {
      "Bb": "A#", "Eb": "D#", "Ab": "G#", "Db": "C#", "Gb": "F#",
      "Bbm": "A#m", "Ebm": "D#m", "Abm": "G#m", "Dbm": "C#m", "Gbm": "F#m"
    };

    const allScales = [
      "C","G","D","A","E","F","Bb","Eb","Ab","Db","Gb","B","F#","C#",
    ,"Bm","Am","Em","Dm","Gm","Cm","Fm","Bbm","Ebm","Abm","Dbm"
    ];

    const scales = {};

    function generateScale(baseNote) {
      let note = baseNote;
      if (!chromatic.includes(baseNote.replace('m',''))) {
        note = enharmonicMap[baseNote];
      }
      if (!note) return;
      const isMinor = baseNote.endsWith('m');
      const steps = isMinor ? [2,1,2,2,1,2,2] : [2,2,1,2,2,2,1];
      let index = chromatic.indexOf(note.replace('m',''));
      const notes = [];
      for (let step of steps) {
        notes.push(chromatic[index % chromatic.length]);
        index += step;
      }
      const pattern = isMinor ? minorPattern : majorPattern;
      scales[baseNote] = pattern.map((p, i) => [p[0], notes[i], p[1], p[2]]);
    }

    allScales.forEach(generateScale);

    function updateTable() {
      const scale = document.getElementById("scaleSelect").value;
      const tableBody = document.getElementById("chordTable");
      tableBody.innerHTML = "";
      if (!scales[scale]) generateScale(scale);
      scales[scale].forEach(row => {
        const tr = document.createElement("tr");

        const degree = document.createElement("td");
        const input1 = document.createElement("input");
        input1.value = row[0];
        input1.readOnly = true;
        degree.appendChild(input1);
        tr.appendChild(degree);

        const chord = document.createElement("td");
        const input2 = document.createElement("input");
        const suffix = row[2] === "minor" ? "m" : row[2] === "diminished" ? "掳" : "";
        input2.value = row[1] + suffix;
        input2.readOnly = true;
        chord.appendChild(input2);
        tr.appendChild(chord);

        const role = document.createElement("td");
        const input3 = document.createElement("input");
        input3.value = row[3];
        input3.readOnly = true;
        role.appendChild(input3);
        tr.appendChild(role);

        tableBody.appendChild(tr);
      });
    }

    function calculateCapo() {
      const from = document.getElementById("fromScale").value;
      const to = document.getElementById("toScale").value;

      const fromNote = from.replace('m','').toUpperCase();
      const toNote = to.replace('m','').toUpperCase();

      const enharmonicNorm = {
        "BB": "A#", "EB": "D#", "AB": "G#", "DB": "C#", "GB": "F#"
      };

      const fromNorm = enharmonicNorm[fromNote] || fromNote;
      const toNorm = enharmonicNorm[toNote] || toNote;

      const fromIndex = chromatic.indexOf(fromNorm);
      const toIndex = chromatic.indexOf(toNorm);

      if (fromIndex === -1 || toIndex === -1) {
        document.getElementById("capoResult").innerText = "专注 砖 砖 拽驻.";
        return;
      }

      const up = (toIndex - fromIndex + 12) % 12;
      const down = (fromIndex - toIndex + 12) % 12;
      const diff = up <= down ? up : -down;

      const result = diff === 0
        ? " 爪专 拽驻 - 转 住."
        : diff > 0
          ? ` 砖砖注  ${to}, 砖 拽驻 注 住专 ${diff}`
          : ` 砖砖注  ${to}, 专 ${Math.abs(diff)} 住专 ( 注专 住  转专)`;

      document.getElementById("capoResult").innerText = result;
    }

    window.onload = () => {
      const scaleSelect = document.getElementById("scaleSelect");
      const fromSelect = document.getElementById("fromScale");
      const toSelect = document.getElementById("toScale");

      allScales.forEach(scale => {
        const opt = document.createElement("option");
        opt.value = opt.text = scale;
        scaleSelect.appendChild(opt);

        if (!scale.endsWith('m')) {
          const optFrom = document.createElement("option");
          optFrom.value = optFrom.text = scale;
          fromSelect.appendChild(optFrom);

          const optTo = document.createElement("option");
          optTo.value = optTo.text = scale;
          toSelect.appendChild(optTo);
        }
      });

      updateTable();
    };
  </script>
</body>
</html>
