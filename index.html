<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title> 拽专 驻 住</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f8;
      direction: rtl;
      text-align: center;
      padding: 20px;
      margin: 0;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h1 {
      font-size: 24px;
      margin-bottom: 20px;
    }

    label, select, input[type="text"], button {
      font-size: 16px;
      width: 100%;
      margin: 8px 0;
    }

    select, input[type="text"] {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 20px;
      background: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
      margin-top: 10px;
    }

    button:hover {
      background: #0056b3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 16px;
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
      text-align: center;
    }

    th {
      background: #f0f0f0;
      font-weight: bold;
    }

    td input {
      width: 100%;
      border: none;
      background: none;
      text-align: center;
      font-size: 16px;
      padding: 0;
    }

    .capo-box {
      margin-top: 30px;
      background: #eef2f7;
      padding: 10px;
      border-radius: 8px;
    }

    /* 专住驻住 - 专住  拽  */
    @media (max-width: 600px) {
      h1 {
        font-size: 20px;
      }

      select, input[type="text"], button, label {
        font-size: 14px;
        padding: 8px;
      }

      table {
        display: none; /* 住转专   */
      }

      /* 爪专 专住 拽 */
      #chordTable tr {
        display: block;
        margin-bottom: 15px;
        padding: 15px;
        background: #fafafa;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-sizing: border-box;
        text-align: right;
      }

      #chordTable tr td {
        display: block;
        padding: 4px 0;
        border: none;
        white-space: normal; /* 驻砖专 砖专转 专转 */
      }

      #chordTable tr td input {
        font-size: 14px;
        padding: 4px 0;
        width: 100%;
        text-align: right;
        border: none;
        background: none;
      }

      /* 转转 驻  砖 专住 */
      #chordTable tr td::before {
        content: attr(data-label);
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
        color: #333;
      }

      /* 拽转  转专转 驻转专 */
      .capo-box {
        padding: 8px;
        font-size: 14px;
      }
      button {
        padding: 8px 16px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1> 拽专 驻 住</h1>

    <label for="scaleSelect">专 住:</label>
    <select id="scaleSelect" onchange="updateTable()">
      <option value="C">C</option>
      <option value="Am">Am</option>
      <option value="E#m">E#m</option>
      <option value="Bb">Bb</option>
      <option value="B#">B#</option>
      <option value="F#m">F#m</option>
    </select>

    <table>
      <thead>
        <tr>
          <th>专</th>
          <th>拽专</th>
          <th>转驻拽 砖注专</th>
        </tr>
      </thead>
      <tbody id="chordTable"></tbody>
    </table>

    <div class="capo-box">
      <h3>砖 拽 拽驻 </h3>
      <label for="fromScale">住 砖转  :</label>
      <select id="fromScale"></select>
      <label for="toScale">住 砖转 专爪 砖砖注:</label>
      <select id="toScale"></select>
      <button onclick="calculateCapo()">砖</button>
      <p id="capoResult"></p>
    </div>
  </div>

  <script>
    const chromatic = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];

    // 驻 砖 转 专 -enharmonic 拽
    const enharmonicMap = {
      "Bb": "A#", "Eb": "D#", "Ab": "G#", "Db": "C#", "Gb": "F#",
      "Cb": "B", "Fb": "E", "E#": "F", "B#": "C",
      "Bbm": "A#m", "Ebm": "D#m", "Abm": "G#m", "Dbm": "C#m", "Gbm": "F#m",
      "Cbm": "Bm", "Fbm": "Em", "E#m": "Fm", "B#m": "Cm"
    };

    // 爪注 住转 '专 专 (专专转 )
    const scaleSteps = {
      major: [2, 2, 1, 2, 2, 2, 1],
      minor: [2, 1, 2, 2, 1, 2, 2],
    };

    // 转驻拽 驻 专 '专 (专专转 )
    const degreeRolesMajor = [
      "专 砖专",
      "砖砖 注拽 注专",
      "爪 专砖",
      "拽专 注专",
      "拽专 拽 驻 专",
      "拽专 注爪/驻 住住",
      " 爪, 爪专 转"
    ];

    // 砖 专 爪   转 (专 专)
    function halfToneDistance(from, to) {
      const fromIndex = chromatic.indexOf(from);
      const toIndex = chromatic.indexOf(to);
      if (fromIndex === -1 || toIndex === -1) return null;
      return (toIndex - fromIndex + 12) % 12;
    }

    // 爪专 住 抓 拽 (root) 住 住
    function generateScale(rootNote, type="major") {
      // 专转 enharmonic  爪专
      let baseNote = enharmonicMap[rootNote] || rootNote;
      let noteRoot = baseNote.replace(/m$/, "");
      const isMinor = rootNote.endsWith("m") || type === "minor";

      const steps = isMinor ? scaleSteps.minor : scaleSteps.major;
      const scaleNotes = [];

      let idx = chromatic.indexOf(noteRoot);
      if (idx === -1) {
        return null; //  转拽
      }
      scaleNotes.push(chromatic[idx]);

      for (let step of steps) {
        idx = (idx + step) % chromatic.length;
        scaleNotes.push(chromatic[idx]);
      }

      // scaleNotes 注砖 8 转 (拽),  爪专 专拽 7
      scaleNotes.pop();

      return scaleNotes;
    }

    // 住 拽专 驻 专  转 专 (3 转)
    function classifyChord(triad) {
      if (triad.length < 3) return " 专";

      // 专转 enharmonic:
      const root = enharmonicMap[triad[0]] || triad[0];
      const third = enharmonicMap[triad[1]] || triad[1];
      const fifth = enharmonicMap[triad[2]] || triad[2];

      const interval1 = halfToneDistance(root, third);
      const interval2 = halfToneDistance(third, fifth);

      if (interval1 === 4 && interval2 === 3) return "Major";
      if (interval1 === 3 && interval2 === 4) return "minor";
      if (interval1 === 3 && interval2 === 3) return "diminished";
      if (interval1 === 4 && interval2 === 4) return "augmented";

      return " 专";
    }

    // 专 拽专 专 住 专
    function getChordFromScale(scaleNotes, degree) {
      const root = scaleNotes[degree];
      // 拽专  专: root + next + next after that (注)
      const third = scaleNotes[(degree + 2) % scaleNotes.length];
      const fifth = scaleNotes[(degree + 4) % scaleNotes.length];

      const chordType = classifyChord([root, third, fifth]);

      const suffix = chordType === "minor" ? "m" : chordType === "diminished" ? "掳" : chordType === "augmented" ? "+" : "";

      return root + suffix;
    }

    function updateTable() {
      const scaleSelect = document.getElementById("scaleSelect");
      const scale = scaleSelect.value.trim();

      //   住 住:  住转 -m = 专, 专转 '专 (驻砖专 专)
      const scaleType = scale.endsWith("m") ? "minor" : "major";

      const scaleNotes = generateScale(scale, scaleType);
      const tableBody = document.getElementById("chordTable");
      tableBody.innerHTML = "";

      if (!scaleNotes) {
        tableBody.innerHTML = "<tr><td colspan='3'>住  拽</td></tr>";
        return;
      }

      const degrees = ["I", "II", "III", "IV", "V", "VI", "VII"];

      degrees.forEach((deg, i) => {
        const tr = document.createElement("tr");

        const degreeCell = document.createElement("td");
        degreeCell.innerText = deg;
        tr.appendChild(degreeCell);

        const chordCell = document.createElement("td");
        chordCell.innerText = getChordFromScale(scaleNotes, i);
        tr.appendChild(chordCell);

        const roleCell = document.createElement("td");
        roleCell.innerText = degreeRolesMajor[i] || "";
        tr.appendChild(roleCell);

        tableBody.appendChild(tr);
      });
    }

    // 拽驻 - 驻拽爪 转拽转
    function calculateCapo() {
      const from = document.getElementById("fromScale").value;
      const to = document.getElementById("toScale").value;

      // 砖转砖 砖 拽专  toUpperCase
      const enharmonicNorm = {
        "Bb": "A#", "Eb": "D#", "Ab": "G#", "Db": "C#", "Gb": "F#",
        "Cb": "B",  "Fb": "E",  "E#": "F",  "B#": "C"
      };

      const fromNorm = enharmonicNorm[from] || from;
      const toNorm = enharmonicNorm[to] || to;

      const fromIndex = chromatic.indexOf(fromNorm);
      const toIndex = chromatic.indexOf(toNorm);

      if (fromIndex === -1 || toIndex === -1) {
        document.getElementById("capoResult").innerText = "专注 砖 砖 拽驻.";
        return;
      }

      const up = (toIndex - fromIndex + 12) % 12;
      const down = (fromIndex - toIndex + 12) % 12;
      const diff = up <= down ? up : -down;

      const result = diff === 0
        ? " 爪专 拽驻 - 转 住."
        : diff > 0
          ? ` 砖砖注  ${to}, 砖 拽驻 注 住专 ${diff}`
          : ` 砖砖注  ${to}, 专 ${Math.abs(diff)} 住专 ( 注专 住  转专)`;

      document.getElementById("capoResult").innerText = result;
    }

    // 注 专砖转 -   转 转驻专 拽驻
    window.onload = () => {
      const scaleSelect = document.getElementById("scaleSelect");
      const fromSelect = document.getElementById("fromScale");
      const toSelect = document.getElementById("toScale");

      //  转驻专 拽驻 专拽 注 住转 '专  专 (驻砖专 专  专爪)
      ["C","G","D","A","E","F","Bb","Eb","Ab","Db","Gb","B","F#","C#"].forEach(scale => {
        let optFrom = document.createElement("option");
        optFrom.value = optFrom.text = scale;
        fromSelect.appendChild(optFrom);

        let optTo = document.createElement("option");
        optTo.value = optTo.text = scale;
        toSelect.appendChild(optTo);
      });

      updateTable();
    };
  </script>
</body>
</html>
